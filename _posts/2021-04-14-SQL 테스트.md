---
layout: page
title: "SQL 테스트"
subtitle: "DATABASE"
date: 2021-04-14
background: '/img/posts/01.jpg'
categories: ['Database']
---

-----

```sql
-- LOCAL_TEST
INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (20, '고구마', 17, '2019-11-30');
INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (19, '감자', 3, '2019-11-30');
INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (18, '호박고구마', 22, '2019-11-30');             INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (17, '호박', 8, '2019-11-30');
INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (16, '감자', 11, '2019-11-29');
INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (15, '호박', 26, '2019-11-29');
INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (14, '고구마', 4, '2019-11-29');
INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (13, '호박고구마', 23, '2019-11-26');
INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (12, '애호박', 7, '2019-11-26');
INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (11, '고구마', 8, '2019-11-26');                 INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (10, '감자', 4, '2019-11-26');                   INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (9, '호박', 5, '2019-11-26');                   INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (8, '고구마', 10, '2019-11-23');                 INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (7, '감자', 8, '2019-11-23');                   INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (6, '고구마', 8, '2019-11-22');   
INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (5, '감자', 12, '2019-11-21');   
INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (4, '호박고구마', 3, '2019-11-21');   
INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (3, '고구마', 7, '2019-11-21');   
INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT) VALUES (2, '호박', 5, '2019-11-21');   

COMMIT; 

ROLLBACK;

SELECT *
FROM SELL
;

-- 일자별 판매순위 1위인 상품을 구하는 쿼리를 작성하시오.
-- 출력 : 일자, 상품명, 판매량
-- 내가 푼 방법
SELECT S1.ITEM_NAME AS 상품명, S2.MC AS 판매량, S2.SELL_DT AS 일자
FROM SELL S1
    INNER JOIN (SELECT MAX(COUNT) AS MC, SELL_DT
FROM SELL GROUP BY SELL_DT) S2
    ON S1.SELL_DT = S2.SELL_DT AND S1.COUNT = S2.MC
ORDER BY S2.SELL_DT DESC
;

SELECT ITEM_NAME AS 상품명, COUNT AS 판매량, SELL_DT AS 일자
FROM (SELECT ITEM_NAME, COUNT, SELL_DT, RANK() OVER(PARTITION BY SELL_DT ORDER BY COUNT DESC) AS RNK
FROM SELL
ORDER BY SELL_DT DESC)
WHERE RNK = 1
;

-- 쌤이 푼 방법
SELECT S.SELL_DT, S.ITEM_NAME, S.COUNT
FROM (SELECT TO_CHAR(SELL_DT, 'YYYY-MM-DD') AS SELL_DT,
        ITEM_NAME, COUNT,
        RANK() OVER(PARTITION BY SELL_DT ORDER BY COUNT DESC) AS RNK
FROM SELL) S
WHERE S.RNK = 1
;
```

