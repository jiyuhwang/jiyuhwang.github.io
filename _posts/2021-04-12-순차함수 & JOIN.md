---
layout: page
title: "순차함수 & JOIN"
subtitle: "DATABASE"
date: 2021-04-12
background: '/img/posts/01.jpg'
categories: ['Database']
---

![순차함수 & JOIN](/img/posts/순차함수 & JOIN.jpg){: width="100%" height="800"}

-----

```sql
-- LOCAL_SCOTT
-- ROW_NUMBER() : 정렬 후 줄번호 할당
SELECT ENAME, SAL,
    ROW_NUMBER() OVER(ORDER BY SAL DESC) AS RNUM
FROM EMP
;

-- RANK() : 순위 지정. 단, 동률이 있는 경우 동률 개수만큼 건너뛰어 번호 할당
SELECT ENAME, SAL,
    RANK() OVER(ORDER BY SAL DESC) AS DNK
FROM EMP
;

-- DENSE_RANK() : 순위 지정. 단, 동률이 있는 경우 다음에 숫자를 이어서 번호 할당
SELECT ENAME, SAL,
    DENSE_RANK() OVER(ORDER BY SAL DESC) AS DENK
FROM EMP
;

SELECT ENAME, SAL,
    ROW_NUMBER() OVER(ORDER BY SAL DESC) AS RNUM,
    RANK() OVER(ORDER BY SAL DESC) AS RNK,
    DENSE_RANK() OVER(ORDER BY SAL DESC) AS DENK
    FROM EMP
;

SELECT ENAME, SAL, JOB,
    ROW_NUMBER() OVER(ORDER BY SAL DESC) AS RNUM,
    RANK() OVER(ORDER BY SAL DESC) AS RNK,
    DENSE_RANK() OVER(ORDER BY SAL DESC) AS DENK
    FROM EMP
;

-- ORACLE의 ROWNUM : 데이터 취득 순서대로 줄번호를 할당한다.
SELECT ENAME, SAL, ROWNUM
FROM EMP
ORDER BY SAL DESC
;

SELECT ENAME, SAL, ROWNUM
FROM(SELECT ENAME, SAL
    FROM EMP
    ORDER BY SAL DESC)
;

-- 업무별 급여 순위를 구하시오.
SELECT ENAME, SAL, JOB,
RANK() OVER(PARTITION BY JOB ORDER BY SAL DESC) AS RNK
FROM EMP
;

-- 부서별 급여순위 1위인 사원을 구하시오.
SELECT ENAME, SAL, DEPTNO
    FROM (SELECT ENAME, SAL, DEPTNO,
    RANK() OVER(PARTITION BY DEPTNO ORDER BY SAL DESC) AS RNK
    FROM EMP)
WHERE RNK = 1
;

-- 가장 많은 급여를 받는 사원의 부서명을 구하시오.
-- HINT1 : SUBQUERY WHERE 절에서 발생
-- HINT2 : SUBQUERY * 2
SELECT DNAME
FROM DEPT
WHERE DEPTNO IN (SELECT DEPTNO
                FROM (SELECT DEPTNO,
                RANK() OVER (ORDER BY SAL DESC) AS RNK
                FROM EMP)
                WHERE RNK =1)
;

--
SELECT *
FROM EMP E INNER JOIN DEPT D
                ON E.DEPTNO = D.DEPTNO
;

--
SELECT *
FROM EMP E LEFT JOIN DEPT D
                    ON E.DEPTNO = D.DEPTNO
ORDER BY E.EMPNO ASC, D.DEPTNO ASC
;

--
SELECT *
FROM EMP E INNER JOIN SALGRADE SG
                    ON 1 = 1
;

--
SELECT *
FROM EMP E INNER JOIN SALGRADE SG
                    ON E.SAL BETWEEN SG.LOSAL AND SG.HISAL
;

--
SELECT E1.ENAME AS 부하직원, E2.ENAME AS 상사
FROM EMP E1 INNER JOIN EMP E2
                    ON E1.MGR = E2.EMPNO
;

-- 사원의 부서명과 급여등급을 출력하시오.
SELECT E.ENAME, D.DNAME, SG.GRADE
FROM EMP E INNER JOIN DEPT D
                ON E.DEPTNO = D.DEPTNO
           INNER JOIN SALGRADE SG
           ON E.SAL BETWEEN SG.LOSAL AND SG.HISAL  
;

SELECT E.ENAME, D.DNAME, SG.GRADE
FROM EMP E,DEPT D, SALGRADE SG
WHERE E.DEPTNO = D.DEPTNO
AND E.SAL BETWEEN SG.LOSAL AND SG.HISAL
;

-- 시카고에 근무하는 사원들의 급여순위를 구하시오.
SELECT ENAME, SAL, LOC, RANK() OVER(ORDER BY SAL DESC) AS RNK
FROM  EMP E INNER JOIN DEPT D
                    ON E.DEPTNO = D.DEPTNO
WHERE D.LOC = 'CHICAGO'
;

SELECT E.ENAME, E.SAL, D.LOC, RANK() OVER(ORDER BY SAL DESC) AS RNK
FROM EMP E INNER JOIN DEPT D
                ON E.DEPTNO = D.DEPTNO
                AND D.LOC = 'CHICAGO'
;

-- 급여등급이 2등급인 사원들 중 부서별 급여 1위를 구하시오.
-- 내가 푼 방법
SELECT  A.ENAME,  A.DNAME,  A.SAL,  A.GRADE
FROM (
SELECT *
FROM (SELECT E.ENAME, E.SAL, E.DEPTNO, SG.GRADE,
        RANK() OVER(PARTITION BY DEPTNO ORDER BY SAL DESC) AS RNK
             FROM EMP E INNER JOIN SALGRADE SG
                     ON E.SAL BETWEEN SG.LOSAL AND SG.HISAL
             WHERE GRADE = 2) EE INNER JOIN DEPT D
                     ON EE.DEPTNO = D.DEPTNO) A
             WHERE  A.RNK = 1 
;

SELECT ENAME, DNAME, SAL, GRADE
FROM (SELECT E.ENAME, E.SAL, E.DEPTNO, SG.GRADE,
        RANK() OVER(PARTITION BY DEPTNO ORDER BY SAL DESC) AS RNK
             FROM EMP E INNER JOIN SALGRADE SG
                     ON E.SAL BETWEEN SG.LOSAL AND SG.HISAL
             WHERE GRADE = 2) EE INNER JOIN DEPT D
                     ON EE.DEPTNO = D.DEPTNO
             WHERE RNK = 1 
;


-- 쌤이 푼 방법
SELECT E.ENAME, E.DNAME, E.SAL, E.GRADE
FROM (SELECT E.ENAME, D.DNAME, E.SAL, SG.GRADE,
        RANK() OVER (PARTITION BY D.DEPTNO ORDER BY E.SAL DESC) AS RNK
           FROM EMP E INNER JOIN DEPT D
                     ON E.DEPTNO = D.DEPTNO
           INNER JOIN SALGRADE SG 
                     ON E.SAL BETWEEN SG.LOSAL AND SG.HISAL
           AND SG.GRADE = 2
         ) E
WHERE E.RNK = 1
;
```

-----

-----

```sql
-- LOCAL_HR
SELECT *
FROM EMPLOYEES E INNER JOIN DEPARTMENTS D
                    ON E.DEPARTMENT_ID = D.DEPARTMENT_ID
;
```

